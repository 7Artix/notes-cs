# 通信协议

## 通信模式

`SPI`总线共有4中通信模式为`Mode0~3`, 决定了数据的采样方式, 取决于以下两个设置的值:
- `CPOL`配置SPI总线的极性
- `CPHA`配置SPI总线的相位

其中`CPOL`决定总线空闲时的电平:
- `CPOL = 1`表示空闲时是高电平
- `CPOL = 0`表示空闲时是低电平

`CPHA`决定总线是从第几个跳变沿开始采样数据:
- `CPHA = 0`表示从第一个跳变沿开始采样
- `CPHA = 1`表示从第二个跳变沿开始采样

以`0b[CPOL][CPHA]`的格式计算`Mode`模式.
例如`Mode 1`为`[CPOL = 0][CPHA = 1]`, 即意味着`CLK`在空闲的时候是低电平, 第一个跳变沿是上升沿, 第二个跳变沿是下降沿, 数据在第二个跳变沿 (下降沿)时采样.

## `CS`片选

当主机选择要与某个指定从机通信时, 主机将该从机`CS`片选信号线`拉低`.

## 通信过程

`CS`, `CLK`, `MOSI`由主机产生, `MISO`由从机产生. 在`SCK`每个时钟周期, `MOSI`和`MISO`产生1位有效数据.
通信从`CS`线电平拉低开始, 至`CS`线电平拉高结束.
数据传输过程中, `MSB`和`LSB`需要在通信设备间保证相同设定.
`SPI`每次传输可以以`8位`或`16位`为单位, 每次传输单位数不受限制.

## 拓展`SPI`协议

为了适应更高速率通信的要求, 发展出多线`SPI`协议.
- `Dual SPI`收发共用两根数据线, 半双工.
- `Quad SPI`收发共用四根数据线, 半双工.
- `Octal SPI`收发共用八根数据线, 半双工.

另外还有`DDR`模式, 即在`SCK`的上升沿和下降沿均进行采样, 获得双倍速率 (`Double Data Rate`).

# `Linux`平台下使用`SPI`

## 设备树

